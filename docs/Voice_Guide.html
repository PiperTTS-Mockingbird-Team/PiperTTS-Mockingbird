<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Piper TTS - Voice Guide</title>
    <!-- Github Markdown CSS for nice standard styling -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.2.0/github-markdown-light.min.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: flex-start;
            padding: 20px;
            margin: 0;
            gap: 20px;
            min-height: 100vh;
        }
        #sidebar {
            width: 280px;
            position: sticky;
            top: 20px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            max-height: calc(100vh - 40px);
            overflow-y: auto;
            flex-shrink: 0;
        }
        #sidebar h3 {
            margin-top: 0;
            font-size: 1.1em;
            color: #24292f;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        #sidebar ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        #sidebar li {
            margin-bottom: 8px;
        }
        #sidebar a {
            text-decoration: none;
            color: #667eea;
            font-size: 0.95em;
            display: block;
            padding: 4px 8px;
            border-radius: 4px;
            transition: all 0.2s;
        }
        #sidebar a:hover {
            background-color: #f3f4f6;
            color: #764ba2;
            transform: translateX(5px);
        }
        .markdown-body {
            box-sizing: border-box;
            min-width: 200px;
            max-width: 980px;
            flex: 1;
            padding: 45px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
        }
        .markdown-body h1 {
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }
        .markdown-body h2 {
            color: #764ba2;
        }
        .markdown-body a {
            color: #667eea;
        }
        .markdown-body a:hover {
            color: #764ba2;
        }
        /* Mobile responsive */
        @media (max-width: 900px) {
            body { 
                flex-direction: column;
                background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
            }
            #sidebar { width: auto; position: static; max-height: none; }
        }
        .loading {
            text-align: center;
            padding: 50px;
            color: #666;
        }
        .error {
            color: #cf222e;
            background-color: #ffebe9;
            padding: 20px;
            border-radius: 6px;
            border: 1px solid #ff818266;
        }
    </style>
    <!-- Marked.js to parse the Markdown -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
    <nav id="sidebar">
        <h3>üé§ Quick Nav</h3>
        <p style="font-size:0.9em; color:#666;">Loading topics...</p>
    </nav>
    <article id="content" class="markdown-body">
        <div class="loading">
            <h2>üéôÔ∏è Loading Voice Guide...</h2>
            <p>Fetching content from HOW_TO_ADD_VOICES.md</p>
        </div>
    </article>

    <script>
        // Function to generate TOC from h2 tags
        function generateTOC() {
            const sidebar = document.getElementById('sidebar');
            const content = document.getElementById('content');
            const headers = content.querySelectorAll('h2');
            
            // Clear existing sidebar content except title
            sidebar.innerHTML = '<h3>üé§ Quick Nav</h3>';
            
            if (headers.length === 0) {
                sidebar.innerHTML += '<p>No sections found.</p>';
                return;
            }

            const list = document.createElement('ul');
            
            headers.forEach((header, index) => {
                // Ensure header has an ID
                if (!header.id) {
                    // Create a friendly ID from text
                    const friendlyId = header.innerText
                        .toLowerCase()
                        .replace(/[^\w\s-]/g, '') // Remove special chars
                        .replace(/\s+/g, '-');    // Replace spaces with hyphens
                    header.id = friendlyId || `section-${index}`;
                }

                const li = document.createElement('li');
                const link = document.createElement('a');
                link.href = `#${header.id}`;
                link.innerText = header.innerText; // Keep emojis
                
                link.onclick = (e) => {
                    e.preventDefault();
                    header.scrollIntoView({ behavior: 'smooth' });

                    // Temporary highlight effect
                    const originalBg = header.style.backgroundColor;
                    const originalTransition = header.style.transition;
                    
                    header.style.transition = 'background-color 0.5s ease';
                    header.style.backgroundColor = '#e0d4ff'; // Light purple
                    
                    setTimeout(() => {
                        header.style.backgroundColor = originalBg;
                        // Clean up transition after it finishes
                        setTimeout(() => {
                            header.style.transition = originalTransition;
                        }, 500); 
                    }, 2000);
                };

                li.appendChild(link);
                list.appendChild(li);
            });

            sidebar.appendChild(list);
        }

        // Function to fetch and render the document
        async function loadReadme() {
            const contentDiv = document.getElementById('content');
            try {
                // This will be replaced with inline content
                const response = await fetch('HOW_TO_ADD_VOICES.md');
                
                if (!response.ok) {
                    throw new Error(`Could not find file (Status: ${response.status})`);
                }

                const text = await response.text();
                
                // Configure marked options if needed
                marked.use({
                    gfm: true,
                    breaks: true
                });

                // Convert markdown to html and inject
                contentDiv.innerHTML = marked.parse(text);

                // Generate TOC after rendering content
                generateTOC();

            } catch (error) {
                console.error(error);
                contentDiv.innerHTML = `
                    <div class="error">
                        <h3>‚ö†Ô∏è Loading Error!</h3>
                        <p><strong>Could not load the documentation file.</strong></p>
                        <p>Detailed Error: ${error.message}</p>
                    </div>
                `;
            }
        }

        // Run on load
        
            const markdownText = "# Adding Voices to Piper TTS Server\n\n## Voices Folder Location\n\nThe `voices/` folder is located inside your `piper_tts_server/` directory:\n```\npiper_tts_server/\n  voices/          <- Add your voice files here\n    female/\n    male/\n  piper_manager_ui.py\n  piper_server.py\n  ...\n```\n\n## Finding Voices\n\n### Listen to voice samples online\n**Preview voices before downloading:**  \nhttps://rhasspy.github.io/piper-samples/\n\n### Download voices\n**Full list of official Piper available voices:**  \nhttps://huggingface.co/rhasspy/piper-voices/tree/main\n\n## Community & Custom Voices\n\n### Create Your Own Voice (Built-in)\nYou can create and train your own custom voices directly from the dashboard! This automated process handles everything from audio slicing to training. \n\nSee the **Creating a Voice with Piper Training Web UI** section below for a step-by-step guide.\n\n### Other Tools\nCheck out **TextyMcSpeechy**, a cool tool that claims to let you train Piper voices locally:  \nhttps://github.com/domesticatedviking/TextyMcSpeechy  \n*(Note: I haven't tested this tool myself, but I found it during my research and it seems cool enough to reference here!)*\n\n### Find More Voices\nPiper is very popular, so there are many community-created voices available online!  \nYou can find voices for popular characters and other unique styles by searching on GitHub and other platforms.\n\n**Community Forum:**  \nHere is a community forum where people share various Piper voices they've found:  \nhttps://community.home-assistant.io/t/collections-of-pre-trained-piper-voices/915666\n\n**\u26a0\ufe0f Disclaimer:** Always exercise caution when downloading files from the internet. Ensure you trust the source before downloading  files.\n\n## Creating a Voice with Piper Training Web UI\n\nFollow these steps to create a custom voice using the integrated training dashboard:\n\n1. **Open Voice Studio**\n   - Click **Voice Studio** in the sidebar to view your voice projects.\n\n2. **Start a New Project**\n   - Click the **+ New Voice** button.\n   - Enter a **Voice Name** (Letters, numbers, and underscores only; **no spaces allowed**).\n   - Select your desired **Quality** and **Gender**.\n   - Choose if you want to **Start Training from Scratch** or use a base model (recommended for faster results).\n   - Click **Create Dojo**.\n\n3. **Prepare Your Dataset (Audio Slicer)**\n   - Click **Upload Master Audio** and select a long recording of the voice you want to clone.\n   - Use the **Tools & Settings** card in the following order:\n     1. **Auto-Detect (Silence)**: Splits your large file into chunks.\n     2. **Whitelist/Blacklist Filter**: Isolate the person's voice you are trying to clone.\n     3. **Auto-Merge Gaps**: Combines segments for better flow.\n     4. **Remove Tiny Segments**: Cleans up small audio artifacts.\n   - Once the segments are ready, click **Next Step: Transcribe**.\n\n4. **Auto-Transcription**\n   - Click **Start AI Transcription**.\n   - The system will automatically transcribe your clips. This takes about 5 minutes (a process that used to take people days to do manually!).\n   - Review and edit the results if needed, then click **Next: Training Setup**.\n\n5. **Training Setup**\n   - Confirm your settings. The system scans and auto-fixes any bugs in the dataset before you start.\n   - Click **Go to Cockpit** (preprocessing may take a couple of minutes).\n\n6. **Training Cockpit**\n   - The training page will open and **automatically start training**.\n   - You can monitor the progress and click the **Stop** button when you wish to end the session.\n\n## How to Add a Voice\n\n1. **Download the voice files**\n   - Each voice needs **two files**:\n     - `voice-name.onnx` - The voice model file (~60MB)\n     - `voice-name.onnx.json` - The voice configuration file (~5KB)\n   - Both files must have matching names\n\n2. **Organize your voices folder**\n   - You can organize voices in subfolders (optional):\n     ```\n     voices/\n       female/\n         en_US-hfc_female-medium.onnx\n         en_US-hfc_female-medium.onnx.json\n       male/\n         en_US-hfc_male-medium.onnx\n         en_US-hfc_male-medium.onnx.json\n       british/\n         en_GB-alba-medium.onnx\n         en_GB-alba-medium.onnx.json\n     ```\n   - Or put them all directly in the `voices/` folder:\n     ```\n     voices/\n       en_US-hfc_female-medium.onnx\n       en_US-hfc_female-medium.onnx.json\n       en_US-hfc_male-medium.onnx\n       en_US-hfc_male-medium.onnx.json\n     ```\n\n3. **Restart the manager UI**\n   - Close and reopen the Piper TTS Server Manager.\n   - The new voices will appear in the dropdown.\n   - **Note:** The server caches the voice list for **60 seconds**. If you add a voice while the server is running, it may take up to a minute to appear in the API, or you can restart the server to clear the cache immediately.\n\n4. **Select and test**\n   - Choose the voice from the dropdown\n   - Click \"Test Voice\" to hear it\n   - The selected voice is saved automatically\n\n## Tips\n\n- **Quality levels**: Voices come in different quality levels (low, medium, high)\n  - `low` - Faster, smaller files, lower quality\n  - `medium` - Balanced (recommended)\n  - `high` - Slower, larger files, best quality\n\n- **Languages**: Piper supports many languages beyond English\n  - Check the VOICES.md list for your language\n  - Examples: `de_DE` (German), `es_ES` (Spanish), `fr_FR` (French)\n\n- **Multi-speaker voices**: Some voices support multiple speakers\n  - You can specify speaker ID in advanced settings (future feature)\n\n## Troubleshooting\n\n- **Voice not showing in dropdown?**\n  - Make sure both `.onnx` and `.onnx.json` files are present\n  - Restart the manager UI\n  - Check the log: \"Found X voice(s): ...\"\n\n- **Voice sounds wrong?**\n  - Verify you downloaded both the `.onnx` AND `.onnx.json` files\n  - The `.onnx.json` file must match the `.onnx` filename exactly\n\n- **Server won't start?**\n  - Large voice models need more memory\n  - Try using \"medium\" quality voices instead of \"high\"\n";
            const contentDiv = document.getElementById('content');
            marked.use({ gfm: true, breaks: true });
            contentDiv.innerHTML = marked.parse(markdownText);
            generateTOC(); // Trigger TOC generation
            
    </script>
</body>
</html>
