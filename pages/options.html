
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>GRAPE ‚Äî Settings</title>
  <style>
    :root{
      color-scheme: light dark;
      --bg: #0b0d12;
      --elev: #0f141b;
      --card: #121924;
      --muted: #9fb3c8;
      --text: #e6eef6;
      --title: #f5f9ff;
      --ring: rgba(124, 58, 237, .45);
      --primary: #7c3aed;
      --primary-700: #6d28d9;
      --border: #1b2633;
      --success: #23c55e;
      --warn: #facc15;
      --danger: #ef4444;
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg: #f7f9fc;
        --elev: #ffffff;
        --card: #ffffff;
        --muted: #556b86;
        --text: #1a2530;
        --title: #0d1b2a;
        --ring: rgba(124, 58, 237, .35);
        --primary: #7c3aed;
        --primary-700: #6d28d9;
        --border: #e7eef6;
        --success: #16a34a;
        --warn: #a16207;
        --danger: #b91c1c;
      }
    }
    *{ box-sizing: border-box; }
    html, body { height: 100%; }
    body{
      margin: 0;
      font: 14px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(circle at 50% 0%, rgba(20,20,30,0.9), rgba(10,10,20,0.95)),
                  var(--bg);
      color: var(--text);
      padding: 24px;
    }
    #c{
      position: fixed;
      inset: 0;
      width: 100vw;
      height: 100vh;
      z-index: 0;
      pointer-events: none;
    }
    .wrap{ position: relative; z-index: 1; max-width: 860px; margin: 0 auto; }
    .header{
      display: grid;
      grid-template-columns: auto 1fr auto;
      gap: 16px;
      align-items: center;
      background: var(--elev);
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 14px 16px;
      box-shadow: 0 8px 30px rgba(0,0,0,.12);
      position: sticky;
      top: 16px;
      backdrop-filter: saturate(1.2) blur(4px);
      z-index: 10;
    }
    .header-actions{ display: inline-flex; align-items: center; gap: 10px; }
    .logo{ width: 56px; height: 56px; border-radius: 14px; background: linear-gradient(150deg, var(--primary), #b794f4); display: grid; place-items: center; overflow: hidden; }
    .logo img{ width: 40px; height: 40px; object-fit: contain; filter: drop-shadow(0 2px 6px rgba(0,0,0,.25)); }
    .title{ display: flex; flex-direction: column; gap: 2px; min-width: 0; }
    .title h1{ margin: 0; font-size: 18px; color: var(--title); letter-spacing: .2px; }
    .subtitle{ margin: 0; color: var(--muted); font-size: 12px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .status{
      font-weight: 600; font-size: 12px; padding: 6px 10px; border-radius: 999px;
      border: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(0,0,0,.06));
      color: var(--danger); min-width: 140px; text-align: center;
    }
    .status:empty{ display:none; }
    .grid{ display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 16px; margin-top: 16px; }
    .card{ background: transparent; border: 1px solid var(--border); border-radius: 16px; padding: 16px; box-shadow: 0 8px 26px rgba(0,0,0,.10); }
    .field{ margin: 10px 0 12px; }
    .label{ display: flex; align-items: center; gap: 8px; font-weight: 600; color: var(--title); margin-bottom: 6px; }
    .hint{ color: var(--muted); font-size: 12px; margin-top: 4px; }
    input[type="number"], input[type="text"], textarea{
      width: 100%; padding: 10px 12px; border-radius: 12px; border: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01)); color: var(--text);
      outline: none; transition: box-shadow .15s ease, border-color .15s ease, transform .04s ease;
    }
    textarea{ resize: vertical; min-height: 84px; }
    input::placeholder, textarea::placeholder{ color: color-mix(in oklab, var(--muted) 88%, transparent); }
    input:focus, textarea:focus{ border-color: var(--primary); box-shadow: 0 0 0 4px var(--ring); }
    button{
      appearance: none; border: 1px solid var(--border);
      background: linear-gradient(180deg, var(--primary), var(--primary-700));
      color: #fff; font-weight: 700; letter-spacing: .2px; padding: 10px 14px; border-radius: 12px;
      cursor: pointer; transition: transform .06s ease, filter .2s ease, box-shadow .2s ease;
      box-shadow: 0 6px 22px rgba(124, 58, 237, .28);
    }
    button:hover{ filter: saturate(1.05) brightness(1.02); }
    button:active{ transform: translateY(1px) scale(.996); }
    .ghost{ background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(0,0,0,.06)); color: var(--title); box-shadow: none; }
    .cost{ display: grid; gap: 6px; border-radius: 14px; padding: 12px; background: linear-gradient(180deg, rgba(0,0,0,.06), rgba(255,255,255,.02)); border: 1px dashed var(--border); color: var(--muted); }
    .cost strong{ color: var(--title); }
    #saveBtn{ animation: pulse 2.4s ease-in-out infinite; }
    @keyframes pulse { 0%{ box-shadow: 0 0 0 0 rgba(124, 58, 237, .38);} 100%{ box-shadow: 0 0 0 12px rgba(124, 58, 237, 0);} }
    kbd{ background: #0d1220; color: #cfe2ff; border: 1px solid var(--border); border-bottom-color: #0a0f18; padding: 2px 6px; border-radius: 6px; font-size: 11px; box-shadow: inset 0 -1px 0 rgba(255,255,255,.04); }

    .card-title{ display:flex; align-items:center; justify-content:space-between; margin-bottom:8px; }
    .card-title h3{ margin:0; font-size:14px; letter-spacing:.2px; color:var(--title); }
    .info-btn{
      background: none;
      border: none;
      color: var(--muted);
      cursor: help;
      padding: 0;
    }
    .info-btn:hover,.info-btn:focus{ outline:none; color: var(--primary); }
    .help-popover{
      position:absolute; max-width: 420px; padding:12px 14px; border-radius:12px;
      border:1px solid var(--border); background: var(--bg); color: var(--text);
      box-shadow: 0 8px 30px rgba(0,0,0,.12); z-index: 1000; font-size: 13px; line-height:1.5;
    }
    .help-popover h5{ margin:0 0 6px 0; font-size: 14px; }

    button[disabled]{
    opacity:.5;
    cursor:not-allowed;
    box-shadow:none;
    animation:none; /* stops the pulse on #saveBtn when locked */
    }

  
  </style>
</head>
<body>
  <canvas id="c"></canvas>
  <div class="wrap">
    <header class="header">
      <div class="logo" aria-hidden="true"><img src="../assets/images/logo.png" alt="GRAPE logo"/></div>
      <div class="title">
        <h1>GRAPE ‚Äî Settings</h1>
        <p class="subtitle">Focus assistant for ChatGPT ‚Ä¢ Visual refresh, same behavior</p>
      </div>
      <div class="header-actions">
        <span id="apiStatus" class="status"></span>
        <button id="saveBtn">üíæ Save settings</button>
      </div>
    </header>

    <section class="grid">
      <article class="card">
        <div class="card-title" data-help-id="SCANNING">
          <h3>Scanning</h3>
          <button class="info-btn" aria-label="More info" aria-haspopup="dialog" aria-expanded="false">‚Ñπ</button>
        </div>
        <div class="field">
          <label class="label" for="charLimit">Scan character limit</label>
          <input type="number" id="charLimit" min="100" max="4000" />
          <div class="hint">How many characters are sent to GPT each scan.</div>
        </div>
        <div class="field">
          <label class="label" for="gptScanInterval">Scan interval (minutes)</label>
          <input type="number" id="gptScanInterval" min="0.1" max="60" step="0.1" />
          <div class="hint">How often GRAPE checks your ChatGPT tab.</div>
        </div>
        <div class="field">
          <label class="label" for="hoursPerDay">Estimated active usage hours per day</label>
          <input type="number" id="hoursPerDay" value="1" min="0" max="24" step="0.1" />
          <div class="hint">Used to project weekly and monthly costs.</div>
        </div>
        <div id="costWrap" class="cost">
          <div class="card-title" data-help-id="COST">
            <strong>üí∞ Cost estimate</strong>
            <button class="info-btn" aria-label="More info" aria-haspopup="dialog" aria-expanded="false">‚Ñπ</button>
          </div>
          <div id="costWeek">$0.00 / week</div>
          <div id="costMonth">$0.00 / month</div>
        </div>
      </article>

      <article class="card">
        <div class="card-title" data-help-id="AI_PROVIDERS">
          <h3>AI Providers</h3>
          <button class="info-btn" aria-label="More info" aria-haspopup="dialog" aria-expanded="false">‚Ñπ</button>
        </div>
        <div id="providerList"></div>
        <p class="hint">
          Need API keys? Watch tutorials for
          <a href="https://www.youtube.com/watch?v=SzPE_AE0eEo" target="_blank">OpenAI</a> or
          <a href="https://www.youtube.com/watch?v=o8iyrtQyrZM" target="_blank">Gemini</a>.
        </p>
      </article>

      <article class="card">
        <div class="card-title" data-help-id="FOCUS_LOCKS">
          <h3>Focus &amp; Lockouts</h3>
          <button class="info-btn" aria-label="More info" aria-haspopup="dialog" aria-expanded="false">‚Ñπ</button>
        </div>
        <div class="field">
          <label class="label" for="blockDuration">Block duration (minutes)</label>
          <input type="number" id="blockDuration" min="0.1" max="720" step="0.1"/>
        </div>
        <div class="field">
          <label class="label" for="blockThreshold">Willpower block threshold</label>
          <input type="number" id="blockThreshold" min="-5" max="10" step="1"/>
          <div class="hint">Lock out if Willpower ‚â§ this value. Range: -5 (lenient) to 10 (strict).</div>
        </div>
        <div class="field">
          <label class="label">
            <input type="checkbox" id="resetFocusOnRestart" />
            Reset focus mode to Always On at browser restart
          </label>
        </div>
      </article>

      <article class="card">
        <div class="card-title" data-help-id="BLOCKED_SITES">
          <h3>Blocked Sites</h3>
          <button class="info-btn" aria-label="More info" aria-haspopup="dialog" aria-expanded="false">‚Ñπ</button>
        </div>
        <div class="field">
          <label class="label" for="blockedSites">Blocked sites (one per line)</label>
          <textarea id="blockedSites" rows="7" placeholder="youtube.com&#10;twitter.com"></textarea>
          <div class="hint">Enter one domain per line. Example: <code>youtube.com</code></div>
        </div>
      </article>

      <article class="card">
        <div class="card-title" data-help-id="BLOCKED_WORDS">
          <h3>Blocked Words</h3>
          <button class="info-btn" aria-label="More info" aria-haspopup="dialog" aria-expanded="false">‚Ñπ</button>
        </div>
        <div class="field">
          <label class="label" for="blockedWords">Blocked words (one per line)</label>
          <textarea id="blockedWords" rows="7" placeholder="facebook&#10;reddit&#10;youtube"></textarea>
          <div class="hint">If any of these are detected in the snippet, GPT will be skipped and a Willpower point deducted.</div>
        </div>
        <div class="field">
          <label class="label" for="bannedCheckInterval">Banned word check interval (seconds)</label>
          <input type="number" id="bannedCheckInterval" min="1" max="300" step="1"/>
          <div class="hint">How often to check for blocked words (default: 30 seconds).</div>
        </div>
      </article>

      <article class="card">
        <div class="card-title" data-help-id="NOTES">
          <h3>Notes</h3>
          <button class="info-btn" aria-label="More info" aria-haspopup="dialog" aria-expanded="false">‚Ñπ</button>
        </div>
        <div class="field">
          <label class="label" for="userNotes">User notes</label>
          <textarea id="userNotes" rows="5" placeholder="Anything you want to remember‚Ä¶"></textarea>
          <div class="hint">Changes apply after you click ‚ÄúSave settings‚Äù in the header.</div>
        </div>
      </article>

      <article class="card">
        <div class="card-title" data-help-id="HEROES">
          <h3>Heroes</h3>
          <button class="info-btn" aria-label="More info" aria-haspopup="dialog" aria-expanded="false">‚Ñπ</button>
        </div>
        <div class="field">
          <label class="label" for="heroes">Your heroes</label>
          <textarea id="heroes" rows="5" placeholder="e.g., Batman&#10;Serena Williams"></textarea>
          <div class="hint">One per line. Used when <code>{hero}</code> appears in your priming template.</div>
        </div>
      </article>

<article class="card">
  <div class="card-title" data-help-id="REDIRECT_PRIMING">
    <h3>Redirect Priming</h3>
    <button class="info-btn" aria-label="More info" aria-haspopup="dialog" aria-expanded="false">‚Ñπ</button>
  </div>
  <div class="field">
    <label class="label" for="insertOnRedirect">
      <input type="checkbox" id="insertOnRedirect" />
      Enable priming (auto-paste message into ChatGPT after redirect)
    </label>
  </div>

  <div class="field">
    <label class="label" for="redirectTemplate">
      Template message
    </label>
    <textarea id="redirectTemplate" rows="8" placeholder="Enter the message to insert‚Ä¶"></textarea>
    <div class="hint">
      You can include <code>{goal}</code> anywhere in the text to insert your current goal from the popup.
    </div>
  </div>
</article>

<article class="card">
  <div class="card-title" data-help-id="LOCKOUT_MSG">
    <h3>Lockout page message</h3>
    <button class="info-btn" aria-label="More info" aria-haspopup="dialog" aria-expanded="false">‚Ñπ</button>
  </div>
  <div class="field">
    <label class="label" for="lockoutCustomText">Custom message (optional)</label>
    <textarea id="lockoutCustomText" placeholder="e.g., ‚ÄòFuture me will be happy I stayed on task.‚Äô"></textarea>
    <div class="hint">Shown on the lockout page under your goal/reason.</div>
  </div>
</article>

<article class="card">
  <div class="card-title" data-help-id="ACCOUNTABILITY">
    <h3>Accountability Intervention (X in Y ‚Üí longer lock)</h3>
    <button class="info-btn" aria-label="More info" aria-haspopup="dialog" aria-expanded="false">‚Ñπ</button>
  </div>

  <div class="field">
    <label class="label">
      <input type="checkbox" id="useAccountabilityIntervention" />
      Enable Accountability Intervention
    </label>
    <div class="hint">When enabled, repeated blocks in a short time trigger a longer lock with a reflection prompt on the lockout page.</div>
  </div>

  <div class="field">
    <label class="label" for="blockLimit">Blocks within window (X)</label>
    <input type="number" id="blockLimit" min="1" max="20" step="1" />
    <div class="hint">How many blocks inside the window trigger the intervention.</div>
  </div>

  <div class="field">
    <label class="label" for="blockWindowMinutes">Window length (minutes, Y)</label>
    <input type="number" id="blockWindowMinutes" min="1" max="720" step="1" />
    <div class="hint">How far back we count recent blocks.</div>
  </div>

  <div class="field">
    <label class="label" for="blockTimeMultiplier">Block time multiplier</label>
    <input type="number" id="blockTimeMultiplier" min="1" max="10" step="0.1" />
    <div class="hint">Multiplies your normal block duration when intervention triggers. Capped by the extension‚Äôs maximum (720 minutes).</div>
  </div>
</article>

<article class="card">
  <div class="card-title">
    <h3>Visual Effects</h3>
  </div>
  <div class="field">
    <label class="label" for="particlesOnOptions">
      <input type="checkbox" id="particlesOnOptions" />
      Enable particles in Settings
    </label>
    <div class="hint">Refresh this page to see changes.</div>
  </div>
  <div class="field">
    <label class="label" for="particlesOnGuide">
      <input type="checkbox" id="particlesOnGuide" />
      Enable particles in User Guide
    </label>
    <div class="hint">Refresh the User Guide to see changes.</div>
  </div>
</article>

<article class="card">
  <div class="card-title" data-help-id="DEBUGGING">
    <h3>Debugging</h3>
    <button class="info-btn" aria-label="More info" aria-haspopup="dialog" aria-expanded="false">‚Ñπ</button>
  </div>
  <div class="field">
    <label class="label" for="debugBackground">
      <input type="checkbox" id="debugBackground" />
      Background logs
    </label>
  </div>
  <div class="field">
    <label class="label" for="debugContent">
      <input type="checkbox" id="debugContent" />
      Content script logs
    </label>
  </div>
  <div class="field">
    <label class="label" for="debugLockout">
      <input type="checkbox" id="debugLockout" />
      Lockout logs
    </label>
  </div>
  <div class="field">
    <label class="label" for="debugRedirector">
      <input type="checkbox" id="debugRedirector" />
      Redirector logs
    </label>
  </div>
  <div class="field">
    <label class="label" for="debugOptions">
      <input type="checkbox" id="debugOptions" />
      Options page logs
    </label>
  </div>
  <div class="field">
    <label class="label" for="debugSnippet">
      <input type="checkbox" id="debugSnippet" />
      Include snippet in debug log
    </label>
  </div>
</article>

</section>
<section id="dnrInspector">
  <details>
    <summary>DNR Inspector</summary>
    <table id="dnrFeatures">
      <thead>
        <tr><th>feature</th><th>activeIds</th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <table id="dnrRules">
      <thead>
        <tr><th>id</th><th>action.type</th><th>redirect.path/urlFilter</th></tr>
      </thead>
      <tbody></tbody>
    </table>
    <button id="dnrCopy">Copy JSON</button>
  </details>
</section>
  </div>

  <script type="module" src="../src/options/options.js"></script>
  <script type="module" src="../src/options/info-help.js"></script>
</body>
</html>
